<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Server.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">server</a> &gt; <span class="el_source">Server.java</span></div><h1>Server.java</h1><pre class="source lang-java linenums">package server;

import static spark.Spark.after;
import CSVUtilities.CSVSearcher.CSVSearcher;
import spark.Spark;

/**
 * Top-level class for this demo. Contains the main() method which starts Spark and runs the various handlers.
 *
 * We have two endpoints in this demo. They need to share state (a menu).
 * This is a great chance to use dependency injection, as we do here with the menu set. If we needed more endpoints,
 * more functionality classes, etc. we could make sure they all had the same shared state.
 */
<span class="nc" id="L14">public class Server {</span>


    /**
     * Container class for CSVSearcher so that all endpoints can view updates to
     * the state (the CSVSearcher)
     */
    public static class CSVSearcherContainer {
        // field containing our searcher so that all endpoints who have access
        // to this class can have access to the updated searcher
        public CSVSearcher searcher;

        /**
         * Constructor for this class
         * @param searcher - the searcher which will be accessed by all endpoints
         */
<span class="nc" id="L30">        public CSVSearcherContainer(CSVSearcher searcher) {</span>
<span class="nc" id="L31">            this.searcher = searcher;</span>
<span class="nc" id="L32">        }</span>
    }

    /**
     * Print error message and exit!
     */
    private static void error() {
<span class="nc" id="L39">        System.err.println(&quot;Server requires three arguments: maxSize (positive integer), &quot; +</span>
          &quot;evictionTime (minutes, positive integer), and maxDistance (km, positive integer)&quot;);
<span class="nc" id="L41">        System.exit(1);</span>
<span class="nc" id="L42">    }</span>

    public static void main(String[] args) {
        // check args length
<span class="nc bnc" id="L46" title="All 2 branches missed.">        if (args.length != 3) {</span>
<span class="nc" id="L47">            error();</span>
        }
        // check args are valid numbers
<span class="nc" id="L50">        int maxSize = -1;</span>
<span class="nc" id="L51">        int evictionTime = -1;</span>
<span class="nc" id="L52">        int maxDistance = -1;</span>
        try {
<span class="nc" id="L54">            maxSize = Integer.parseInt(args[0]);</span>
<span class="nc" id="L55">            evictionTime = Integer.parseInt(args[1]);</span>
<span class="nc" id="L56">            maxDistance = Integer.parseInt(args[2]);</span>
<span class="nc bnc" id="L57" title="All 6 branches missed.">            if (maxSize &lt; 0 || evictionTime &lt; 0 || maxDistance &lt; 0) {</span>
<span class="nc" id="L58">                throw new NumberFormatException();</span>
            }
<span class="nc" id="L60">        } catch (NumberFormatException nfx) {</span>
<span class="nc" id="L61">            error();</span>
<span class="nc" id="L62">        }</span>

        // set spark port!
<span class="nc" id="L65">        Spark.port(3232);</span>
        /*
            Setting CORS headers to allow cross-origin requests from the client; this is necessary for the client to
            be able to make requests to the server.

            By setting the Access-Control-Allow-Origin header to &quot;*&quot;, we allow requests from any origin.
            This is not a good idea in real-world applications, since it opens up your server to cross-origin requests
            from any website. Instead, you should set this header to the origin of your client, or a list of origins
            that you trust.

            By setting the Access-Control-Allow-Methods header to &quot;*&quot;, we allow requests with any HTTP method.
            Again, it's generally better to be more specific here and only allow the methods you need, but for
            this demo we'll allow all methods.

            We recommend you learn more about CORS with these resources:
                - https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS
                - https://portswigger.net/web-security/cors
         */
<span class="nc" id="L83">        after((request, response) -&gt; {</span>
<span class="nc" id="L84">            response.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span>
<span class="nc" id="L85">            response.header(&quot;Access-Control-Allow-Methods&quot;, &quot;*&quot;);</span>
<span class="nc" id="L86">        });</span>

        // make a new container containing null - can be filled by loadcsv
<span class="nc" id="L89">        CSVSearcherContainer searcherContainer = new CSVSearcherContainer(null);</span>
        // Init a Converter for the cache
<span class="nc" id="L91">        WeatherLoader myLoader = new WeatherLoader();</span>

        // Setting up the handlers for the endpoints
        //Spark.get(&quot;help&quot;, new HelpHandler());
<span class="nc" id="L95">        Spark.get(&quot;loadcsv&quot;, new LoadCSVHandler(searcherContainer));</span>
<span class="nc" id="L96">        Spark.get(&quot;searchcsv&quot;, new SearchCSVHandler(searcherContainer));</span>
<span class="nc" id="L97">        Spark.get(&quot;viewcsv&quot;, new ViewCSVHandler(searcherContainer));</span>
<span class="nc" id="L98">        Spark.get(&quot;weather&quot;, new WeatherHandler(maxSize, evictionTime, maxDistance, myLoader));</span>
        // Spark.get(&quot;weather&quot;, new WeatherHandler(weatherAPIProxy));
<span class="nc" id="L100">        Spark.init();</span>
<span class="nc" id="L101">        Spark.awaitInitialization();</span>
<span class="nc" id="L102">        System.out.println(&quot;Server started.&quot;);</span>
<span class="nc" id="L103">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>